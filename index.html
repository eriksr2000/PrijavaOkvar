<!DOCTYPE html>
<html lang="sl">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0">
<title>Prijava okvar strojev</title>

<script src="bazaStrojev.js"></script>
<script src="bazaStrojnikov.js"></script>

<style>
  body{font-family:Arial,sans-serif;background:#f4f4f4;margin:0;padding:12px}
  h1{text-align:center;color:#b52b27;margin-bottom:20px}
  .section{background:#fff;border-radius:14px;padding:14px;margin-bottom:14px;box-shadow:0 2px 6px rgba(0,0,0,.15)}
  label{font-weight:bold;margin-top:10px;display:block;color:#333}
  select,textarea,input[type=file]{width:100%;padding:12px;font-size:16px;border-radius:10px;border:1px solid #ccc;margin-top:6px;box-sizing:border-box}
  
  /* Radio Buttons Styling */
  .radio-row{display:flex;gap:8px;margin-top:10px;flex-wrap:wrap}
  .radio-btn{flex:1;min-width:80px;text-align:center;padding:12px 5px;border-radius:12px;border:2px solid #ccc;font-size:14px;cursor:pointer;background:#fff;transition:0.2s}
  .radio-btn input{display:none}
  .radio-btn:has(input:checked) {border-color:#d9534f;background:#ffeeee;color:#d9534f;font-weight:bold;}

  /* Submit Button */
  button{width:100%;padding:18px;font-size:18px;font-weight:bold;border:none;border-radius:14px;background:#d9534f;color:#fff;margin-top:10px;cursor:pointer;box-shadow:0 4px 6px rgba(217,83,79,0.3)}
  button:active{background:#b52b27;transform:scale(0.98)}
  
  .hint{font-size:12px;color:#666;margin-top:5px;display:block}
</style>
</head>
<body>

<h1>üöß Prijava okvare stroja</h1>

<form id="reportForm" action="https://formsubmit.co/svajgerramicerik@gmail.com" method="POST" enctype="multipart/form-data">
  

  <input type="hidden" name="_captcha" value="false">
  <input type="hidden" name="_template" value="table">
  
  <input type="hidden" name="_subject" id="emailSubject" value="Nova prijava okvare">

  <div class="section">
    <label>Stroj</label>
    <select id="stroj" name="Stroj" required>
      <option value="" disabled selected>Izberi stroj...</option>
    </select>

    <label>Strojnik</label>
    <select id="strojnik" name="Strojnik" required>
      <option value="" disabled selected>Izberi strojnika...</option>
    </select>
  </div>

  <div class="section">
    <label>Vrsta okvare</label>
    <div class="radio-row">
      <label class="radio-btn"><input type="radio" name="Vrsta_okvare" value="Mehanska" required><span>Mehanska</span></label>
      <label class="radio-btn"><input type="radio" name="Vrsta_okvare" value="Hidravliƒçna"><span>Hidravliƒçna</span></label>
      <label class="radio-btn"><input type="radio" name="Vrsta_okvare" value="Elektriƒçna"><span>Elektriƒçna</span></label>
      <label class="radio-btn"><input type="radio" name="Vrsta_okvare" value="Drugo"><span>Drugo</span></label>
    </div>

    <label>Opis okvare</label>
    <textarea id="opis" name="Opis_okvare" rows="3" placeholder="Kratko opi≈°i te≈æavo..." required></textarea>

    <label>üì∑ Fotografije</label>
    <input type="file" name="attachment" accept="image/*" capture="environment" multiple>
    <span class="hint">Lahko izbere≈° veƒç slik hkrati.</span>
  </div>

  <button type="submit" id="submitBtn">Po≈°lji prijavo</button>
  
</form>

<script>
// 1. POLNJENJE SEZNAMOV (Brez sprememb)
const strojSel = document.getElementById("stroj");
const strojnikSel = document.getElementById("strojnik");

if (typeof stroji !== 'undefined') {
  stroji.forEach(s => {
    const o = document.createElement("option");
    o.value = `${s.inventar} (${s.vrsta})`; 
    o.textContent = `${s.inventar} ‚Äì ${s.vrsta} ${s.proizvajalec}`;
    strojSel.appendChild(o);
  });
}

if (typeof strojniki !== 'undefined') {
  Object.entries(strojniki).forEach(([id, ime]) => {
    const o = document.createElement("option");
    o.value = `${id} - ${ime}`; 
    o.dataset.id = id;          
    o.textContent = `${id} ‚Äì ${ime}`;
    strojnikSel.appendChild(o);
  });
}

// 2. POSODOBITEV ZADEVE (SUBJECT) PRED PO≈†ILJANJEM
const form = document.getElementById("reportForm");
const submitBtn = document.getElementById("submitBtn");

form.addEventListener("submit", function(e) {
  // Tukaj NE prepreƒçimo po≈°iljanja (ne uporabimo preventDefault),
  // samo nastavimo pravilno besedilo za naslov emaila.
  
  const strojVal = strojSel.value.split(' ')[0] || "Neznano";
  const strojnikOption = strojnikSel.options[strojnikSel.selectedIndex];
  const strojnikVal = strojnikOption.dataset.id || "Neznano";
  
  // Preverimo kateri radio button je izbran
  const vrstaEl = document.querySelector('input[name="Vrsta_okvare"]:checked');
  const vrstaVal = vrstaEl ? vrstaEl.value : "Drugo";

  // Nastavimo skrito polje _subject
  document.getElementById("emailSubject").value = `Stroj - "${strojVal}"; Strojnik - "${strojnikVal}"; Vrsta okvare - "${vrstaVal}"`;

  // Spremenimo gumb, da uporabnik ve, da se dogaja
  submitBtn.innerText = "Po≈°iljanje... Poƒçakajte trenutek.";
  submitBtn.disabled = true;
});
</script>

</body>
</html>